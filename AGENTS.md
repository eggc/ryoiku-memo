# アプリケーション概要

発達障害やその他の障害を持つ子供の療育記録を取るためのアプリです。
主に父親と母親が共同で記録・閲覧することを想定しています。

## 主な機能

- **ノート**: 記録の基本単位。一人が複数のノートを管理でき、他のユーザーと「共同編集」が可能です。
- **タイムライン**: ノート内のスタンプを時系列で表示します。月ごとの切り替え（横スワイプ対応）や Pull-to-refresh を備えています。
- **スタンプ**: 「ねる」「おきる」「メモ」「おでかけ」などのイベントを記録。一部のスタンプ（メモ・おでかけ）は詳細入力ダイアログが表示され、過去の履歴から補完が可能です。
- **ふりかえり**: 月ごとの記録を多角的に分析します。
  - **日記**: スタンプの詳細テキストを抽出し、ノート風の罫線背景にアイコン付きで表示します。特定のスタンプ種別でのフィルタリングが可能です。
  - **睡眠グラフ**: 睡眠・起床スタンプから睡眠時間を視覚化します。
- **インポート・エクスポート**: データの永続性を保証するため、ノート単位で CSV 形式の書き出し・取り込みが可能です。
- **ログイン**:
  - Firebase Auth (Google ログイン) を使用。
  - ログイン時は Firestore に保存され、複数端末で同期されます。
  - 非ログイン時は SharedPreferences によるローカル保存となります。

# 設計・構成の知見

## UI/UX 基本方針
- **モダンな操作感**: 月移動には `HorizontalPager` を使用し、直感的なスワイプ操作を提供します。
- **ダークモード対応**: `MaterialTheme.colorScheme` を徹底的に利用し、ハードコードされた色（`Color.Blue`など）を避けます。
- **入力の効率化**: 頻繁に入力する「おでかけ先」などはサジェスト機能を提供し、自由記述の「メモ」は広めの入力エリアを確保します。

## 実装ガイドライン
- **非同期処理**: Jetpack Compose 内での `suspend` 関数呼び出し（特に `Result` のインライン関数内）には注意し、必要に応じて `coroutineScope.launch` や `try-catch` を適切に使い分けます。
- **一括データ処理**: インポートなどの大量書き込み時は `NoteRepository.saveStamps` を使用し、Firestore の `WriteBatch`（最大500件）などのバッチ処理を活用してパフォーマンスを最適化します。
- **テキスト装飾**: 日記機能のようにアイコンとテキストを混在させる場合は、`AnnotatedString` と `InlineTextContent` を使用して、自然な回り込みと正確な行間（1.5倍など）を実現します。
- **状態の同期**: アプリ全体で共有する状態（表示月など）は `MainActivity` で管理し、各スクリーンにコールバックと共に渡すことで、タブを切り替えてもコンテキストが維持されるようにします。

## パッケージ・依存関係
- 日本語で会話してください。
- なるべく最新のパッケージを使用してください。
  - `.ktx` 拡張が暗黙的に同梱されるようになったライブラリ（Firebase 等）での重複インポートに注意してください。
    - OK: `import com.google.firebase.auth.auth`
    - NG: `import com.google.firebase.auth.ktx.auth`
- ID生成には `jnanoid` を使用し、短く衝突しにくい共同編集IDを発行します。
